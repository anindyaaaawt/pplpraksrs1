{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Input Use Case</title>
    <link rel="stylesheet" href="{% static 'main/css/global.css' %}">
</head>
<body>
    <div style="min-height: 100vh; background-color: #f9fafb; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
        <!-- Header -->
        <header style="background-color: #ffffff; border-bottom: 1px solid #e5e7eb; padding: 0 24px;">
            <div style="max-width: 1200px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; height: 64px;">
                <!-- Logo -->
                <div style="display: flex; align-items: center; gap: 8px;">
                    <div style="width: 24px; height: 24px; background-color: #111827; border-radius: 4px; display: flex; align-items: center; justify-content: center;">
                        <span style="color: white; font-size: 12px; font-weight: bold;">⚡</span>
                    </div>
                    <span style="font-size: 20px; font-weight: 600; color: #111827;">One UML</span>
                </div>
                
                <!-- Navigation -->
                <nav style="display: flex; align-items: center; gap: 32px;">
                    <a href="{%  url 'home' %}" style="color: #6b7280; text-decoration: none; font-size: 14px;">Home</a>
                    <a href="#" style="color: #6b7280; text-decoration: none; font-size: 14px;">User Stories</a>
                    <a href="#" style="color: #111827; text-decoration: none; font-size: 14px; font-weight: 500;">Use Cases</a>
                </nav>
            </div>
        </header>

        <!-- Main Content -->
        <main style="max-width: 1200px; margin: 0 auto; padding: 32px 24px;">
            <div style="display: grid; grid-template-columns: 1fr 320px; gap: 48px;">
                <!-- Left Column - Form -->
                <div style="background-color: #ffffff; border-radius: 8px; border: 1px solid #e5e7eb; padding: 32px;">
                    <!-- Header -->
                    <div style="margin-bottom: 32px;">
                        <h1 style="font-size: 28px; font-weight: 600; color: #111827; margin-bottom: 8px;">Input Use Case</h1>
                        <p style="color: #6b7280; font-size: 14px;">Create a new use case and optionally generate a corresponding user story</p>
                    </div>

                    <!-- Actor Section -->
                    <div style="margin-bottom: 24px;">
                        <label style="display: block; font-size: 14px; font-weight: 500; color: #111827; margin-bottom: 8px;">
                            Actor(s) <span style="color: #ef4444;">*</span>
                        </label>
                        <div id="actorContainer" style="border: 1px solid #d1d5db; border-radius: 6px; padding: 12px; background-color: #ffffff; margin-bottom: 12px;">
                            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                <span class="actor-tag" data-actor="Student" style="background-color: #f3f4f6; padding: 6px 12px; border-radius: 16px; font-size: 14px; color: #374151; cursor: pointer;">Student</span>
                                <span class="actor-tag" data-actor="Teacher" style="background-color: #f3f4f6; padding: 6px 12px; border-radius: 16px; font-size: 14px; color: #374151; cursor: pointer;">Teacher</span>
                                <span class="actor-tag" data-actor="Administrator" style="background-color: #f3f4f6; padding: 6px 12px; border-radius: 16px; font-size: 14px; color: #374151; cursor: pointer;">Administrator</span>
                                <span class="actor-tag" data-actor="System" style="background-color: #f3f4f6; padding: 6px 12px; border-radius: 16px; font-size: 14px; color: #374151; cursor: pointer;">System</span>
                            </div>
                        </div>
                        <button id="addActorBtn" style="display: flex; align-items: center; gap: 4px; color: #2563eb; font-size: 14px; background: none; border: none; cursor: pointer;">
                            <span style="font-size: 16px;">+</span> Add new actor
                        </button>
                        <p style="font-size: 12px; color: #6b7280; margin-top: 4px;">Choose one or more actors involved in this use case</p>
                    </div>

                    <!-- Use Case Title -->
                    <div style="margin-bottom: 24px;">
                        <label style="display: block; font-size: 14px; font-weight: 500; color: #111827; margin-bottom: 8px;">
                            Use Case Title <span style="color: #ef4444;">*</span>
                        </label>
                        <input id="useCaseTitle" type="text" placeholder="e.g., Upload Assignment" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; background-color: #ffffff;" />
                    </div>

                    <!-- Brief Description -->
                    <div style="margin-bottom: 24px;">
                        <label style="display: block; font-size: 14px; font-weight: 500; color: #111827; margin-bottom: 8px;">Brief Description / Intent</label>
                        <textarea id="briefDescription" placeholder="Short description to capture intent/reason" style="width: 100%; height: 100px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; background-color: #ffffff; resize: vertical;"></textarea>
                    </div>

                    <!-- Preconditions -->
                    <div style="margin-bottom: 24px;">
                        <label style="display: block; font-size: 14px; font-weight: 500; color: #111827; margin-bottom: 8px;">Precondition(s)</label>
                        <textarea id="preconditions" placeholder="Conditions that must be true before the use case starts" style="width: 100%; height: 80px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; background-color: #ffffff; resize: vertical;"></textarea>
                    </div>

                    <!-- Triggers -->
                    <div style="margin-bottom: 24px;">
                        <label style="display: block; font-size: 14px; font-weight: 500; color: #111827; margin-bottom: 8px;">Trigger(s)</label>
                        <textarea id="triggers" placeholder="What initiates this use case" style="width: 100%; height: 80px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; background-color: #ffffff; resize: vertical;"></textarea>
                    </div>

                    <!-- Main Flow -->
                    <div style="margin-bottom: 24px;">
                        <label style="display: block; font-size: 14px; font-weight: 500; color: #111827; margin-bottom: 8px;">Main Flow (Steps)</label>
                        <p style="font-size: 12px; color: #6b7280; margin-bottom: 12px;">Add steps one by one in the order they occur</p>
                        
                        <div id="mainFlowSteps">
                            <div class="main-step" style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                <div style="display: flex; align-items: center; gap: 4px; color: #6b7280;">
                                    <span style="cursor: move;">⋮⋮</span>
                                    <span class="step-number" style="font-weight: 500;">1.</span>
                                </div>
                                <input type="text" placeholder="Step description" style="flex: 1; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; background-color: #ffffff;" />
                                <button class="remove-step" style="color: #6b7280; background: none; border: none; cursor: pointer; padding: 4px;">×</button>
                            </div>
                        </div>

                        <button id="addMainStepBtn" style="display: flex; align-items: center; gap: 4px; color: #2563eb; font-size: 14px; background: none; border: none; cursor: pointer;">
                            <span style="font-size: 16px;">+</span> Add Step
                        </button>
                    </div>

                    <!-- Alternative Flow -->
                    <div style="margin-bottom: 24px;">
                        <label style="display: block; font-size: 14px; font-weight: 500; color: #111827; margin-bottom: 12px;">Alternative Flow(s)</label>
                        
                        <div id="alternativeFlows">
                            <div class="alt-flow" style="margin-bottom: 24px; padding: 16px; border: 1px solid #e5e7eb; border-radius: 6px;">
                                <input type="text" placeholder="Alternative flow title/condition" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; background-color: #ffffff; margin-bottom: 12px;" />
                                
                                <div class="alt-steps">
                                    <div class="alt-step" style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                        <span class="alt-step-number" style="font-weight: 500; color: #6b7280; min-width: 20px;">1.</span>
                                        <input type="text" placeholder="Alternative step description" style="flex: 1; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; background-color: #ffffff;" />
                                        <button class="remove-alt-step" style="color: #6b7280; background: none; border: none; cursor: pointer; padding: 4px;">×</button>
                                    </div>
                                </div>

                                <button class="add-alt-step" style="display: flex; align-items: center; gap: 4px; color: #2563eb; font-size: 14px; background: none; border: none; cursor: pointer; margin-bottom: 12px;">
                                    <span style="font-size: 16px;">+</span> Add Step
                                </button>

                                <button class="remove-alt-flow" style="color: #ef4444; font-size: 12px; background: none; border: none; cursor: pointer;">Remove Alternative Flow</button>
                            </div>
                        </div>

                        <button id="addAltFlowBtn" style="display: flex; align-items: center; gap: 4px; color: #2563eb; font-size: 14px; background: none; border: none; cursor: pointer;">
                            <span style="font-size: 16px;">+</span> Add Alternative Flow
                        </button>
                    </div>

                    <!-- Postconditions -->
                    <div style="margin-bottom: 32px;">
                        <label style="display: block; font-size: 14px; font-weight: 500; color: #111827; margin-bottom: 8px;">Postcondition(s)</label>
                        <textarea id="postconditions" placeholder="Conditions that will be true after successful completion" style="width: 100%; height: 80px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; background-color: #ffffff; resize: vertical;"></textarea>
                    </div>

                    <!-- Action Buttons -->
                    <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
                        <button id="saveBtn" style="background-color: #111827; color: #ffffff; padding: 12px 24px; border-radius: 6px; font-size: 14px; font-weight: 500; border: none; cursor: pointer;">
                            Save Use Case
                        </button>
                        <button id="saveGenerateBtn" style="background-color: #374151; color: #ffffff; padding: 12px 24px; border-radius: 6px; font-size: 14px; font-weight: 500; border: none; cursor: pointer;">
                            Save + Generate User Story
                        </button>
                        <button id="previewBtn" style="color: #6b7280; padding: 12px 24px; border-radius: 6px; font-size: 14px; font-weight: 500; border: 1px solid #d1d5db; background-color: #ffffff; cursor: pointer;">
                            Preview Use Case Diagram
                        </button>
                        <button style="color: #6b7280; padding: 12px 24px; border-radius: 6px; font-size: 14px; font-weight: 500; border: 1px solid #d1d5db; background-color: #ffffff; cursor: pointer;">
                            Back
                        </button>
                    </div>
                </div>

                <!-- Right Column - Tutorial -->
                <div style="background-color: #ffffff; border-radius: 8px; border: 1px solid #e5e7eb; padding: 24px; height: fit-content;">
                    <h3 style="font-size: 18px; font-weight: 600; color: #111827; margin-bottom: 16px;">Tutorial & Example</h3>
                    
                    <div style="margin-bottom: 24px;">
                        <h4 style="font-size: 14px; font-weight: 500; color: #111827; margin-bottom: 8px;">Mapping Guidance</h4>
                        <p style="font-size: 12px; color: #6b7280; line-height: 1.5; margin-bottom: 12px;">When generating a User Story, fields will map as follows:</p>
                        <ul style="font-size: 12px; color: #6b7280; line-height: 1.4;">
                            <li style="margin-bottom: 4px;">• Actor → "As a [Actor]"</li>
                            <li style="margin-bottom: 4px;">• Title → "I want [Title]"</li>
                            <li style="margin-bottom: 4px;">• Description → "So that [Description]"</li>
                        </ul>
                    </div>

                    <div>
                        <h4 style="font-size: 14px; font-weight: 500; color: #111827; margin-bottom: 12px;">Example</h4>
                        <div style="background-color: #f9fafb; border-radius: 6px; padding: 16px;">
                            <p style="font-size: 12px; color: #6b7280; margin-bottom: 8px;">If actor = "Student" and title = "Upload Assignment":</p>
                            <div id="exampleStory" style="background-color: #ffffff; border-radius: 4px; padding: 12px; border: 1px solid #e5e7eb;">
                                <p style="font-size: 13px; color: #111827; line-height: 1.4;">
                                    <strong>"As a Student, I want to Upload Assignment, so that I can submit my work for grading."</strong>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer style="background-color: #ffffff; border-top: 1px solid #e5e7eb; padding: 16px 24px; margin-top: 48px;">
            <div style="max-width: 1200px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between;">
                <p style="font-size: 12px; color: #6b7280;">© 2025 One UML. All rights reserved.</p>
                <div style="display: flex; align-items: center; gap: 24px;">
                    <a href="#" style="font-size: 12px; color: #6b7280; text-decoration: none;">Help</a>
                    <a href="#" style="font-size: 12px; color: #6b7280; text-decoration: none;">Privacy</a>
                    <a href="#" style="font-size: 12px; color: #6b7280; text-decoration: none;">Terms</a>
                </div>
            </div>
        </footer>
    </div>

    <script>
        class UseCaseForm {
            constructor() {
                this.selectedActors = new Set();
                this.init();
            }

            init() {
                this.bindActorEvents();
                this.bindStepEvents();
                this.bindFlowEvents();
                this.bindFormEvents();
                this.updateExample();
            }

            // Actor Management
            bindActorEvents() {
                const actorTags = document.querySelectorAll('.actor-tag');
                actorTags.forEach(tag => {
                    tag.addEventListener('click', () => this.toggleActor(tag));
                });

                document.getElementById('addActorBtn').addEventListener('click', () => {
                    const actorName = prompt('Enter new actor name:');
                    if (actorName && actorName.trim()) {
                        this.addCustomActor(actorName.trim());
                    }
                });
            }

            toggleActor(tag) {
                const actor = tag.dataset.actor;
                if (this.selectedActors.has(actor)) {
                    this.selectedActors.delete(actor);
                    tag.style.backgroundColor = '#f3f4f6';
                    tag.style.color = '#374151';
                } else {
                    this.selectedActors.add(actor);
                    tag.style.backgroundColor = '#2563eb';
                    tag.style.color = '#ffffff';
                }
                this.updateExample();
            }

            addCustomActor(actorName) {
                const container = document.querySelector('#actorContainer > div');
                const newTag = document.createElement('span');
                newTag.className = 'actor-tag';
                newTag.dataset.actor = actorName;
                newTag.style.cssText = 'background-color: #f3f4f6; padding: 6px 12px; border-radius: 16px; font-size: 14px; color: #374151; cursor: pointer;';
                newTag.textContent = actorName;
                newTag.addEventListener('click', () => this.toggleActor(newTag));
                container.appendChild(newTag);
            }

            // Step Management
            bindStepEvents() {
                document.getElementById('addMainStepBtn').addEventListener('click', () => {
                    this.addMainStep();
                });

                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('remove-step')) {
                        this.removeMainStep(e.target.closest('.main-step'));
                    }
                });
            }

            addMainStep() {
                const container = document.getElementById('mainFlowSteps');
                const stepCount = container.querySelectorAll('.main-step').length + 1;
                
                const stepDiv = document.createElement('div');
                stepDiv.className = 'main-step';
                stepDiv.style.cssText = 'display: flex; align-items: center; gap: 12px; margin-bottom: 12px;';
                stepDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 4px; color: #6b7280;">
                        <span style="cursor: move;">⋮⋮</span>
                        <span class="step-number" style="font-weight: 500;">${stepCount}.</span>
                    </div>
                    <input type="text" placeholder="Step description" style="flex: 1; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; background-color: #ffffff;" />
                    <button class="remove-step" style="color: #6b7280; background: none; border: none; cursor: pointer; padding: 4px;">×</button>
                `;
                container.appendChild(stepDiv);
            }

            removeMainStep(stepElement) {
                stepElement.remove();
                this.updateStepNumbers();
            }

            updateStepNumbers() {
                const steps = document.querySelectorAll('#mainFlowSteps .step-number');
                steps.forEach((step, index) => {
                    step.textContent = `${index + 1}.`;
                });
            }

            // Alternative Flow Management
            bindFlowEvents() {
                document.getElementById('addAltFlowBtn').addEventListener('click', () => {
                    this.addAlternativeFlow();
                });

                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('add-alt-step')) {
                        this.addAlternativeStep(e.target.closest('.alt-flow'));
                    }
                    if (e.target.classList.contains('remove-alt-step')) {
                        this.removeAlternativeStep(e.target.closest('.alt-step'));
                    }
                    if (e.target.classList.contains('remove-alt-flow')) {
                        e.target.closest('.alt-flow').remove();
                    }
                });
            }

            addAlternativeFlow() {
                const container = document.getElementById('alternativeFlows');
                const flowDiv = document.createElement('div');
                flowDiv.className = 'alt-flow';
                flowDiv.style.cssText = 'margin-bottom: 24px; padding: 16px; border: 1px solid #e5e7eb; border-radius: 6px;';
                flowDiv.innerHTML = `
                    <input type="text" placeholder="Alternative flow title/condition" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; background-color: #ffffff; margin-bottom: 12px;" />
                    <div class="alt-steps">
                        <div class="alt-step" style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                            <span class="alt-step-number" style="font-weight: 500; color: #6b7280; min-width: 20px;">1.</span>
                            <input type="text" placeholder="Alternative step description" style="flex: 1; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; background-color: #ffffff;" />
                            <button class="remove-alt-step" style="color: #6b7280; background: none; border: none; cursor: pointer; padding: 4px;">×</button>
                        </div>
                    </div>
                    <button class="add-alt-step" style="display: flex; align-items: center; gap: 4px; color: #2563eb; font-size: 14px; background: none; border: none; cursor: pointer; margin-bottom: 12px;">
                        <span style="font-size: 16px;">+</span> Add Step
                    </button>
                    <button class="remove-alt-flow" style="color: #ef4444; font-size: 12px; background: none; border: none; cursor: pointer;">Remove Alternative Flow</button>
                `;
                container.appendChild(flowDiv);
            }

            addAlternativeStep(flowElement) {
                const stepsContainer = flowElement.querySelector('.alt-steps');
                const stepCount = stepsContainer.querySelectorAll('.alt-step').length + 1;
                
                const stepDiv = document.createElement('div');
                stepDiv.className = 'alt-step';
                stepDiv.style.cssText = 'display: flex; align-items: center; gap: 12px; margin-bottom: 12px;';
                stepDiv.innerHTML = `
                    <span class="alt-step-number" style="font-weight: 500; color: #6b7280; min-width: 20px;">${stepCount}.</span>
                    <input type="text" placeholder="Alternative step description" style="flex: 1; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; background-color: #ffffff;" />
                    <button class="remove-alt-step" style="color: #6b7280; background: none; border: none; cursor: pointer; padding: 4px;">×</button>
                `;
                stepsContainer.appendChild(stepDiv);
            }

            removeAlternativeStep(stepElement) {
                const flowElement = stepElement.closest('.alt-flow');
                stepElement.remove();
                this.updateAltStepNumbers(flowElement);
            }

            updateAltStepNumbers(flowElement) {
                const steps = flowElement.querySelectorAll('.alt-step-number');
                steps.forEach((step, index) => {
                    step.textContent = `${index + 1}.`;
                });
            }

            // Form Management
            bindFormEvents() {
                const titleInput = document.getElementById('useCaseTitle');
                const descInput = document.getElementById('briefDescription');
                
                titleInput.addEventListener('input', () => this.updateExample());
                descInput.addEventListener('input', () => this.updateExample());

                document.getElementById('saveBtn').addEventListener('click', () => {
                    this.saveUseCase();
                });

                document.getElementById('saveGenerateBtn').addEventListener('click', () => {
                    this.saveAndGenerateUserStory();
                });

                document.getElementById('previewBtn').addEventListener('click', () => {
                    this.previewDiagram();
                });
            }

            updateExample() {
                const actors = Array.from(this.selectedActors);
                const title = document.getElementById('useCaseTitle').value || 'Upload Assignment';
                const description = document.getElementById('briefDescription').value || 'I can submit my work for grading';
                
                const actor = actors.length > 0 ? actors[0] : 'Student';
                const exampleText = `"As a ${actor}, I want to ${title}, so that ${description}."`;
                
                document.getElementById('exampleStory').innerHTML = `
                    <p style="font-size: 13px; color: #111827; line-height: 1.4;">
                        <strong>${exampleText}</strong>
                    </p>
                `;
            }

            // Action Methods
            saveUseCase() {
                const data = this.collectFormData();
                console.log('Saving use case:', data);
                alert('Use case saved successfully!');
            }

            saveAndGenerateUserStory() {
                const data = this.collectFormData();
                console.log('Saving and generating user story:', data);
                alert('Use case saved and user story generated!');
            }

            previewDiagram() {
                alert('Preview diagram feature coming soon!');
            }

            collectFormData() {
                return {
                    actors: Array.from(this.selectedActors),
                    title: document.getElementById('useCaseTitle').value,
                    description: document.getElementById('briefDescription').value,
                    preconditions: document.getElementById('preconditions').value,
                    triggers: document.getElementById('triggers').value,
                    postconditions: document.getElementById('postconditions').value,
                    mainFlow: this.getMainFlowSteps(),
                    alternativeFlows: this.getAlternativeFlows()
                };
            }

            getMainFlowSteps() {
                const steps = document.querySelectorAll('#mainFlowSteps .main-step input');
                return Array.from(steps).map(input => input.value).filter(value => value.trim());
            }

            getAlternativeFlows() {
                const flows = document.querySelectorAll('.alt-flow');
                return Array.from(flows).map(flow => {
                    const title = flow.querySelector('input[type="text"]').value;
                    const steps = Array.from(flow.querySelectorAll('.alt-step input'))
                        .map(input => input.value).filter(value => value.trim());
                    return { title, steps };
                });
            }
        }

        // Initialize the form when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new UseCaseForm();
        });
    </script>
    
</body>
</html>